{% extends "base.html" %}

{% load url from future %}

{% block header_extra %}
  <!-- TODO: REMOVE -->  
  <!-- <link href="{{ STATIC_URL }}css/vegancity.css" rel="stylesheet"/> -->

  <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}/js/map.js"></script>
  <script type="text/javascript">

    var vendors = [
    {% for vendor in vendors %}{% if vendor.latitude %}
      [{{ vendor.latitude }}, {{vendor.longitude }}, 
      '\
      <strong>{{vendor.name}}</strong><br/>\
      {{vendor.address}}<br/>\
      {{vendor.phone}}<br/>\
      <a href="{%url 'vendor_detail' object_id=vendor.id %}">More Info</a> | \
      <a href="http://maps.google.com/maps?q={{ vendor.address }}" target="_BLANK">jump to Google Maps</a><br/>\
      ', {{ vendor.id }}],
    {% endif %}{% endfor %}
    ];
  </script>

{% endblock %}

{% block headline %}{% endblock %}

{% block summary %}
{% endblock summary %}

{% block content %}

  <!-- FIRST ROW -->  
  <div class="row">
    <div class="span6">
      <form action="{% url 'vendors' %}" method="get" class="form-search">
        <input type="hidden" name="cuisine" {% if selected_cuisine %}value="{{ selected_cuisine }}"{% endif %}>
        <input type="hidden" name="neighborhood" {% if selected_neighborhood %}value="{{ selected_neighborhood }}"{% endif %}>
        {% for f in checked_feature_filters %}
          <input type="hidden" name="{{ f.name }}" value="true">
        {% endfor %}
        <input id="search-input" type="text" class="input-large" placeholder="e.g., south and broad, blackbird pizza, burritos" autofocus="autofocus" name="query" {% if query %}value="{{ query }}"{% endif %}>
        <button type="submit" class="btn btn-primary">Search</button>
        <!-- TODO : make this button work with jquery and stop filter -->        
        <!-- <button class="btn btn-warning" type="reset" id="vc-search-reset">Reset</button> -->
      </form>
      {% if vendors %}
        <div id="map_canvas"></div>
      {% endif %}
    </div>

    <div class="span6">
      <div class="row">
        <div class="span3">
          <form action="{% url 'vendors' %}" method="get" name="filters" id="filters">
            <input type="hidden" name="query" value="{{ query }}">

            <h4>Neighborhood:</h4>
            <select name="neighborhood" onchange="this.form.submit()">
              <option value="" selected="selected">---------</option>
              {% for neighborhood in neighborhoods %}
                <option value="{{neighborhood.name}}" {% if neighborhood.name == selected_neighborhood %}selected="selected"{% endif %}>{{ neighborhood.name }}</option>
              {% endfor %}
            </select>

            {% if cuisines %}
              <h4>Cuisine: </h4>
              <select name="cuisine" onchange="this.form.submit()">
                <option value="" selected="selected">---------</option>
                {% for cuisine in cuisines %}
                  {{cuisine.name}}              
                  <option value="{{cuisine.name}}" {% if cuisine.name == selected_cuisine %}selected="selected"{% endif %}>{{ cuisine.description }}</option>
                {% endfor %}
              </select>
            {% endif %}

            {% if feature_filters or checked_feature_filters %}
              <h4>Features:</h4>
              {% if checked_feature_filters %}
                {% for filter in checked_feature_filters %}
                  <label class="checkbox"><input type="checkbox" name="{{ filter.name }}" value="true" onchange="this.form.submit()" checked="1">{{ filter.description }}</label>
                {% endfor %}
                <br>
              {% endif %}

              {% if feature_filters %}            
                <select name="feature" onchange="this.form.submit()">
                  <option value="" selected="selected">---------</option>
                  {% for feature in feature_filters %}
                    {% if feature not in checked_feature_filters %}
                      {{feature.name}}              
                      <option value="{{feature.name}}" {% if feature.name == selected_feature %}selected="selected"{% endif %}>{{ feature.description }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
              {% endif %}
            {% endif %}
          </form>

          <p><a href="{% url 'vendors' %}" class="btn btn-warning">Clear All Filters</a></p>
          <br>
          
          <h4>Something missing?</h4>
          <h4><a href="{% url 'new_vendor' %}" class="btn btn-primary">Add a Restaurant!</a></h4>
        </div>


        <div class="span3">
          <table id="vendorList" class="table-striped">
            <thead>
              <tr>
                <th>Map</th>
                <th>Results ({{ vendors.count }})</th>
              </tr>
            </thead>
            <tbody>
              {% for vendor in vendors %}
                <tr>
                  <td><img src="//www.google.com/mapfiles/marker.png" class="marker-link vendor-{{vendor.id}}"></td>
                  <td><a href="{% url 'vendor_detail' object_id=vendor.id %}">{{ vendor.name }}</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        


      </div>
    </div>
  </div>
</div>

{% endblock content %}
