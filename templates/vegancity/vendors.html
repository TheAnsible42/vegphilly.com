{% extends "base.html" %}

{% load url from future %}

{% load vegancity_template_tags %}

{% block header_extra %}
  <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}/js/map.js"></script>
  <script type="text/javascript">

    var vendors = [
    {% for vendor in search_form.vendors %}{% if vendor.latitude %}
      [{{ vendor.latitude }}, {{vendor.longitude }}, 
      '\
      <strong>{{vendor.name}}</strong><br/>\
      {{vendor.address}}<br/>\
      {{vendor.phone}}<br/>\
      <a class="uline" href="{%url 'vendor_detail' object_id=vendor.id %}">More Info</a> | \
      <a class="uline" href="http://maps.google.com/maps?q={{ vendor.address }}" target="_BLANK">jump to Google Maps</a><br/>\
      ', {{ vendor.id }}],
    {% endif %}{% endfor %}
    ];

    var typeahead_values = [
    "West Philly",
    "North Philly",
    ]    

  </script>
    {{ search_form.media }}
{% endblock %}

{% block headline %}{% endblock %}

{% block summary %}
{% endblock summary %}

{% block content %}

  <!-- FIRST ROW -->  
  <div class="row">
    <div class="span6">

      <form action="{% url 'vendors' %}" method="get" name="filters" id="filters" class="form-search">
        <input id="search_type" name="search_type" type="hidden" value="{{ search_form.search_type }}">
        {% if search_from.old_query %}
        <input id="old_query" name="old_query" type="hidden" value="{{ search_form.old_query }}">
      {% endif %}
        <input id="search-input" type="text" class="input-large" 
               autofocus="autofocus" autocomplete="off" name="query" 
               {% if search_form.query %}value="{{ search_form.query }}"{% endif %}
               data-provide="typeahead" data-source='[
               "West Philly",
               "North Philly",               
               ]'>

        <button type="submit" class="btn btn-custom">Search</button>
        <br><br>
               <div class="btn-group">
                 {% if search_form.search_type %}
                 <button class="btn btn-custom">Search by {{ search_form.search_type }}</button>
                 <button class="btn btn-warning dropdown-toggle" data-toggle="dropdown">
                   <span class="caret"></span>
                 </button>
               {% else %}
                 <button class="btn btn-custom dropdown-toggle" data-toggle="dropdown">
                   Search
                 </button>                   
               {% endif %}
                 </button>
                 <ul class="dropdown-menu">
                   <li><a type="#" id="search_by_name">Search by Name</a></li>
                   <li><a href="#" id="search_by_tag">Search by Tag</a></li>
                   <li><a href="#" id="search_by_address">Search by Address</a></li>
                 </ul>
               </div>

        <br>
        <h5>{{ search_form.search_type|showing_vendors_string }}{% if search_form.query %}"{{ search_form.query }}"{% endif %}</h5>

      {% if search_form.vendors %}
        <div id="map_canvas"></div>
      {% endif %}
    </div>

    <div class="span6">
      <div class="row">
        <div class="span3">

            <h4>Neighborhood:</h4>
            {{ search_form.neighborhood }}
            <h4>Cuisine:</h4>
            {{ search_form.cuisine }}
            <h4>Features:</h4>
            {{ search_form.checked_features }}
            {% for checked in search_form.checked_feature_filters %}
              <label class="checkbox">
                <input type="checkbox" name="{{ checked.name }}" value="True" checked="checked" onchange="this.form.submit()">
                {{ checked }}
              </label>
            {% endfor %}         
            {{ search_form.feature }}

          </form>

          <p><a href="{% url 'vendors' %}" class="btn btn-warning">Clear All Filters</a></p>
          <br>
          
          <h4>Something missing?</h4>
          <h4><a href="{% url 'new_vendor' %}" class="btn btn-custom">Add a Restaurant</a></h4>
        </div>


        <div class="span3">
          <table id="vendorList" class="table-striped">
            <thead>
              <tr>
                <th>Map</th>
                <th>Results ({{ search_form.vendor_count }})</th>
              </tr>
            </thead>
            <tbody>
              {% for vendor in search_form.vendors %}
                <tr>
                  <td><img src="//www.google.com/mapfiles/marker.png" class="marker-link vendor-{{vendor.id}}"></td>
                  <td><a class="uline" href="{% url 'vendor_detail' object_id=vendor.id %}">{{ vendor.name }}</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        


      </div>
    </div>
  </div>
</div>

{% endblock content %}
