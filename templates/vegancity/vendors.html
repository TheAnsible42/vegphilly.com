{% extends "base.html" %}

{% load url from future %}

{% block title %}VegPhilly | Restaurants{% endblock %}


{% load vegancity_template_tags %}

{% block headline %}{% endblock %}

{% block summary %}
{% endblock summary %}

{% block content %}
  <div class="container">

  <!-- FIRST ROW -->  
  <div class="row">
    <div class="span6">

      <form action="{% url 'vendors' %}" method="get" name="filters" id="filters" class="form-search">
        {% if search_type %}
          {% comment %}If there's a search_type, stick it in the form, otherwise dont.
This prevents null searches from getting a value of None stuck here and throwing off the UI.{% endcomment %}            
        <input id="search_type" name="search_type" type="hidden" value="{{ search_type }}">
      {% endif %}        
        {% if search_from.old_query %}
        <input id="previous_query" name="previous_query" type="hidden" value="{{ previous_query }}">
      {% endif %}
        <input id="search-input" type="text" class="input-large" 
               autofocus="autofocus" autocomplete="off" name="current_query" 
               {% if current_query %}value="{{ current_query }}"{% endif %}>
                 {% if search_type %}
               <div class="btn-group">
                 <button class="btn btn-custom" id="search_by_dynamic" title="{{ search_type|format_button_title }}">Search by {{ search_type|format_search_type }}</button>
                 <button class="btn btn-warning dropdown-toggle" data-toggle="dropdown">
                   <span class="caret"></span>
                 </button>
                 <ul class="dropdown-menu">
                   <li><a type="#" id="search_by_name">Search by Name</a></li>
                   <li><a href="#" id="search_by_tag">Search by Cuisine & Feature</a></li>
                   <li><a href="#" id="search_by_location">Search by Location</a></li>
                 </ul>
               </div>
               {% else %}
                 <button class="btn btn-custom" id="search_by_dynamic">Search</button>
               {% endif %}
                 <a href="#" class="btn btn-warning" id="clear_search">Clear Search</a>
        <br>
        {% if current_query %}
        <h5 id="result-description">Showing {% if vendors %}only{% else %}no{% endif %} results{{ search_type|showing_vendors_string }}{% if current_query %}"{{ current_query }}"{% endif %}</h5>
      {% else %}
        <br>
      {% endif %}
      {% if vendors %}
        <div id="map_canvas"></div>
      {% else %}
        <div id="map_canvas" style="visibility: hidden"></div>
      {% endif %}
    </div>

    <div class="span6">
      <div class="row">
        <div class="span3">

            <h4>Neighborhood:</h4>
              <select id="id_neighborhood" name="neighborhood">
                <option value="" {% if not selected_neighborhood_id %}selected="selected"{% endif %}>---------</option>
                {% for neighborhood in neighborhoods %}
                <option value="{{ neighborhood.id }}" {% if neighborhood.id == selected_neighborhood_id %}selected="selected"{% endif %}>{{ neighborhood.name }}</option>
                {% endfor %}
              </select>
            <h4>Cuisine:</h4>
              <select id="id_cuisine" name="cuisine_tag">
                <option value="" {% if not selected_cuisine_tag_id %}selected="selected"{% endif %}>---------</option>
                {% for cuisine_tag in cuisine_tags %}
                <option value="{{ cuisine_tag.id }}" {% if cuisine_tag.id == selected_cuisine_tag_id %}selected="selected"{% endif %}>{{ cuisine_tag.description }}</option>
                {% endfor %}
              </select>

            <h4>Features:</h4>

            {% for checked in checked_feature_filters %}
              <label class="checkbox">
                <input type="checkbox" id="id_feature_{{ checked.name }}" name="{{ checked.name }}" value="True" checked="checked" onchange="this.form.submit()">
                {{ checked }}
              </label>
            {% endfor %}         
              <select id="id_feature" name="feature_tag">
                <option value="" {% if selected_feature_tag %}selected="selected"{% endif %}>---------</option>
                {% for feature_tag in feature_tags %}
                <option value="{{ feature_tag.id }}">
                  {{ feature_tag.description }}
                </option>
                {% endfor %}
              </select>

          </form>

          <p><a href="#" class="btn btn-warning" id="clear_all">Clear Filters</a></p>
          <br>
          
          <h4>Something missing?</h4>
          <h4><a href="{% url 'new_vendor' %}" class="btn btn-custom">Add a Restaurant</a></h4>
          <br><br>
          <table id="legend-table">
            <thead>
              <!-- TODO: this is an html hack -->
               <h4>Legend</h4>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>


        <div class="span3" id="vendor_table">
          <table id="vendorList" class="table-striped">
            <thead>
              <tr>
                <th>Map</th>
                <th>Results ({{ vendor_count|default:"0" }})</th>
              </tr>
            </thead>
            <tbody>
              {% for vendor in vendors %}
                <tr>
                  <td><img src="" class="marker-link vendor-{{vendor.id}} veg-level-{{vendor.veg_level_id|default:"0"}}"></td>
                  <td><a class="blue" href="{{ vendor.get_absolute_url }}">{{ vendor.name }}</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        


      </div>
    </div>

    


  </div>
  </div>
{% endblock content %}

{% block body_extra %}
<meta name="description" content="View local vegan and vegetarian restaurants in Philly. Search food vendors by cuisine, features, or neighborhood.">
  <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
  <script type="text/javascript">

    var autoResize = {% if has_get_params %}true{% else %}false{% endif %};
    var defaultCenter = new google.maps.LatLng({{ center_latitude }}, {{ center_longitude }});
    var vendors = [
    {% for vendor in vendors %}
      {% if vendor.location %}
        {
            id: "{{ vendor.id }}",
            name: "{{ vendor.name }}",
            address: "{{ vendor.address|linebreaksbr }}",
            phone: "{{ vendor.phone }}",
            url: "{{ vendor.get_absolute_url }}",
            latitude: "{{ vendor.location.y }}", 
            longitude: "{{ vendor.location.x }}",
            vegLevel: {% if vendor.veg_level %}{{ vendor.veg_level_id }}{% else %}0{% endif %}
        }{% if not forloop.last %},{% endif %}
      {% endif %}
    {% endfor %}
    ];

  </script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/map.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/vendors.js"></script>
{% endblock body_extra %}
